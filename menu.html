<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sistema de Control</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3b82f6">

  <!-- Estilos -->
  <link rel="stylesheet" href="menu.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <!-- Leaflet Map -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  <!-- PDF generation (pdfmake) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
  <!-- QR Code generation -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>

<body>
  <div class="app">
    <!-- ===== Sidebar ===== -->
    <aside class="sidebar" id="sidebar" aria-label="Barra lateral">
      <div class="brand">
        <button id="burger" class="burger" aria-label="Colapsar men√∫" aria-expanded="true">
          <span></span><span></span><span></span>
        </button>
        <span class="logo"></span>
        <span class="brand-text">Sistema de Control</span>
      </div>

      <nav class="nav" role="navigation">
        <button class="nav-item active" data-target="view-kpi" aria-current="page">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M3 3v18h18" />
            <path d="M7 13l3 3 7-7" />
          </svg>
          <span>KPI</span>
        </button>
        <button class="nav-item" data-target="view-usuarios">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
            <circle cx="9" cy="7" r="4" />
          </svg>
          <span>Usuarios</span>
        </button>
        <button class="nav-item" data-target="view-cliente-unidad">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <rect x="2" y="7" width="20" height="14" rx="2" ry="2" />
            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
          </svg>
          <span>Cliente/Unidad</span>
        </button>
        <button class="nav-item" data-target="view-tipo-incidencias">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <span>Tipo Incidencias</span>
        </button>
        <button class="nav-item" data-target="view-cuaderno">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
          </svg>
          <span>Cuaderno</span>
        </button>
        <button class="nav-item" data-target="view-incidencias">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
            <line x1="12" y1="9" x2="12" y2="13" />
            <line x1="12" y1="17" x2="12.01" y2="17" />
          </svg>
          <span>Incidencias</span>
        </button>

        <button class="nav-item" data-target="view-tiempo-conexion">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="9" />
            <polyline points="12 6 12 12 16 14" />
          </svg>
          <span>‚è±Ô∏è Tiempo de conexi√≥n</span>
        </button>

        <!-- Rondas con submen√∫ -->
        <div class="nav-group">
          <button class="nav-group-toggle" aria-expanded="false">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <circle cx="12" cy="12" r="10" />
              <polyline points="12 6 12 12 16 14" />
            </svg>
            <span>üìã Rondas</span>
            <svg class="icon-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="nav-group-menu">
            <button class="nav-subitem" data-target="view-crear-qr">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <rect x="3" y="3" width="7" height="7" />
                <rect x="14" y="3" width="7" height="7" />
                <rect x="3" y="14" width="7" height="7" />
                <rect x="14" y="14" width="7" height="7" />
              </svg>
              <span>üî≤ Crear QR</span>
            </button>
            <button class="nav-subitem" data-target="view-crear-rondas">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M9 11l3 3L22 4" />
                <path d="M20 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h11" />
              </svg>
              <span>‚úì Crear Rondas</span>
            </button>
          </div>
        </div>
      </nav>

      <div class="spacer"></div>
      <button class="logout" id="logoutBtn" type="button" title="Cerrar sesi√≥n">Cerrar sesi√≥n</button>
    </aside>

    <!-- ===== Main ===== -->
    <main class="main">
      <header class="topbar">
        <button id="menuToggleBtn" class="menu-toggle" aria-label="Abrir men√∫" aria-expanded="false">
          <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none"
            stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <h1 class="title">Panel LiderControl</h1>
        <div class="topbar-right">
          <!-- ===== LOGO EMPRESA ===== -->
          <div class="logo-empresa-topbar">
            <img src="logo_liberman.png" alt="Logo Liberman" class="logo-empresa-img-topbar" />
          </div>
          <!-- ===== INFO USUARIO ===== -->
          <div class="userpill">
            <div class="avatar" id="avatar">U</div>
            <div class="userinfo">
              <strong id="userName">Usuario</strong>
              <small class="muted" id="userMeta">Bienvenido(a)</small>
            </div>
          </div>
        </div>
      </header>

      <section class="views">
        <!-- ===== KPI ===== -->
        <div id="view-kpi" class="view shown">
          <nav class="kpi-subnav">
            <button class="kpi-subnav-btn active" data-target="kpi-resumen">Resumen</button>
            <button class="kpi-subnav-btn" data-target="kpi-detalle-incidentes">Detalle de Incidentes</button>
            <button class="kpi-subnav-btn" data-target="kpi-ronda-general">Ronda General</button>
            <button class="kpi-subnav-btn" data-target="kpi-detalle-rondas">Detalle de Rondas</button>
            <button class="kpi-subnav-btn" data-target="kpi-acceso-peatonal">Acceso Peatonal</button>
            <button class="kpi-subnav-btn" data-target="kpi-detalle-acceso">Detalle Acceso</button>
            <button class="kpi-subnav-btn" data-target="kpi-control-vehicular">üöó Control Vehicular</button>
            <button class="kpi-subnav-btn" data-target="kpi-incidencia-qr">üî≤ Rondas Manuales</button>
            <button class="kpi-subnav-btn" data-target="kpi-incidencias-hm">Incidencias H&M</button>
          </nav>

          <div class="kpi-subviews-container">
            <!-- PESTA√ëA 1: RESUMEN -->
            <div id="kpi-resumen" class="kpi-subview active" role="tabpanel">
              <div class="resumen-filters">
                <div class="filters-wrapper">
                  <div class="filter-item">
                    <label class="filter-label">Cliente</label>
                    <select id="resumen-filtro-cliente"></select>
                  </div>
                  <div class="filter-item">
                    <label class="filter-label">Unidad</label>
                    <select id="resumen-filtro-unidad"></select>
                  </div>
                  <div class="filter-item">
                    <label class="filter-label">C√≥digos</label>
                    <select id="resumen-filtro-categoria"></select>
                  </div>
                  <div class="filter-item">
                    <label class="filter-label">Nivel de Riesgo</label>
                    <select id="resumen-filtro-riesgo"></select>
                  </div>
                  <div class="filter-item filter-date-range">
                    <label class="filter-label">Fecha</label>
                    <input type="text" id="resumen-filtro-fecha" class="date-picker"
                      placeholder="DD/MM/YYYY - DD/MM/YYYY" />
                    <button type="button" class="btn small" id="resumen-btn-refresh"
                      style="height:36px; padding:0.5rem 0.75rem; margin-left:0.5rem;">Aplicar</button>
                  </div>
                </div>
                <div class="total-mini">
                  <div class="total-mini__num" id="resumen-total-incidentes">0</div>
                  <div class="total-mini__label">Incidentes Registrados</div>
                </div>
              </div>
              <div class="resumen-grid">

                <div class="kpi-card card-riesgo">
                  <h4>Q¬∞ Incidentes por Nivel de Riesgo</h4>
                  <canvas id="resumen-chart-riesgo"></canvas>
                </div>

                <div class="kpi-card card-categoria">
                  <h4>Q¬∞ Incidentes por Categor√≠a</h4>
                  <canvas id="resumen-chart-categoria"></canvas>
                </div>

                <div class="kpi-card heatmap-card card-heatmap">
                  <h4 id="heatmap-title">Mapa de Calor de Incidentes</h4>
                  <div class="table-wrap">
                    <table id="resumen-tabla-heatmap" aria-labelledby="heatmap-title"></table>
                  </div>
                </div>

                <div class="kpi-card card-unidad">
                  <h4>Q¬∞ Incidentes por Unidad</h4>
                  <canvas id="resumen-chart-unidad"></canvas>
                </div>

                <div class="kpi-card card-fecha">
                  <h4>Q¬∞ de Incidencias por Fecha</h4>
                  <canvas id="resumen-chart-fecha"></canvas>
                </div>

                <div class="kpi-card map-card card-sedes">
                  <h4>Mapa de Sedes</h4>
                  <div id="resumen-map" style="width:100%; height:100%; border-radius:8px; overflow:hidden;"></div>
                </div>

                <div class="kpi-card card-mes">
                  <h4>Q¬∞ Incidencias Registradas por Mes</h4>
                  <canvas id="resumen-chart-mes"></canvas>
                </div>
              </div>
            </div>

            <!-- Pesta√±a 2: DETALLE DE INCIDENTES -->
            <div id="kpi-detalle-incidentes" class="kpi-subview" role="tabpanel">
              <div class="page-head">
                <h2>An√°lisis de Incidentes por Categor√≠a</h2>
                <form class="actions kpi-actions">
                  <label>Cliente<select id="detalle-filtro-cliente"></select></label>
                  <label>Unidad<select id="detalle-filtro-unidad"></select></label>
                  <label>A√±o<select id="detalle-filtro-year"></select></label>
                  <label>Fecha Inicio<input type="date" id="detalle-filtro-fecha-inicio" /></label>
                  <label>Fecha Fin<input type="date" id="detalle-filtro-fecha-fin" /></label>
                  <button type="button" class="btn small" id="detalle-btn-refresh">Recargar</button>
                  <button type="button" class="btn small secondary" id="detalle-btn-export">Exportar Excel</button>
                </form>
              </div>
              <div class="kpi-layout">
                <main class="kpi-main">
                  <div class="kpi-chart-wrapper">
                    <canvas id="detalle-chart-area"></canvas>
                  </div>
                  <div class="kpi-tables-wrapper">
                </main>
                <aside class="kpi-sidebar" id="detalle-sidebar-stats">
                  <!-- Tarjetas din√°micas generadas por JavaScript -->
                </aside>
              </div>
            </div>

            <!-- Pesta√±a 3: ACCESO PEATONAL -->
            <div id="kpi-acceso-peatonal" class="kpi-subview" role="tabpanel">
              <form class="ap-filters ap-filters--row">
                <label>Cliente
                  <select id="ap-filtro-cliente"></select>
                </label>
                <label>Sedes
                  <select id="ap-filtro-sede"></select>
                </label>
                <label>Tipo Acceso
                  <select id="ap-filtro-tipo"></select>
                </label>
                <label>Fecha
                  <input type="text" id="ap-filtro-fecha" class="date-picker" />
                </label>
                <button type="button" class="btn small" id="ap-btn-aplicar">Aplicar</button>
              </form>

              <div class="ap-charts-grid-custom">
                <!-- FILA 1: L√≠nea izq + Tarjetas derecha -->
                <div class="grid-row-1">
                  <!-- Izquierda: Gr√°fico de l√≠nea -->
                  <div class="kpi-card ap-line">
                    <h4>üìà Q¬∞ de accesos por fecha</h4>
                    <canvas id="ap-chart-fecha"></canvas>
                  </div>

                  <!-- Derecha: Tarjetas de informaci√≥n en columnas -->
                  <div class="ap-stats-right">
                    <div class="ap-stat-card ap-stat-primary">
                      <div class="stat-value" id="ap-total">0</div>
                      <div class="stat-label">Accesos Totales</div>
                      <div class="stat-icon">üë•</div>
                    </div>
                    <div class="ap-stat-card ap-stat-visit">
                      <div class="stat-value" id="ap-visita">0</div>
                      <div class="stat-label">Visitas</div>
                      <div class="stat-icon">üè¢</div>
                    </div>
                    <div class="ap-stat-card ap-stat-provider">
                      <div class="stat-value" id="ap-proveedor">0</div>
                      <div class="stat-label">Proveedores</div>
                      <div class="stat-icon">üöö</div>
                    </div>
                    <div class="ap-stat-card ap-stat-contractor">
                      <div class="stat-value" id="ap-contratista">0</div>
                      <div class="stat-label">Contratistas</div>
                      <div class="stat-icon">üë∑</div>
                    </div>
                  </div>
                </div>

                <!-- FILA 2: Doughnut + Empresa lado a lado -->
                <div class="grid-row-2">
                  <div class="kpi-card ap-donut">
                    <h4>üìä Q¬∞ de accesos por estado</h4>
                    <canvas id="ap-chart-estado"></canvas>
                  </div>

                  <div class="kpi-card ap-by-company">
                    <h4>üè¢ Q¬∞ Accesos por compa√±√≠a</h4>
                    <canvas id="ap-chart-empresa"></canvas>
                  </div>
                </div>

                <!-- FILA 3: Heatmap + Unidades lado a lado -->
                <div class="grid-row-3">
                  <div class="kpi-card ap-heatmap">
                    <h4 id="ap-heatmap-title">üî• Mapa de calor de accesos</h4>
                    <div class="table-wrap">
                      <table id="ap-tabla-heatmap" aria-labelledby="ap-heatmap-title"></table>
                    </div>
                  </div>

                  <div class="kpi-card ap-by-unit">
                    <h4>üè™ Q¬∞ Accesos por Unidad</h4>
                    <canvas id="ap-chart-unidad"></canvas>
                  </div>
                </div>
              </div>
            </div>
            <!-- PESTA√ëA 4: INCIDENCIAS H&M -->
            <div id="kpi-incidencias-hm" class="kpi-subview" role="tabpanel">
              <div class="page-head">
                <h2>Dashboard Incidencias H&M</h2>
                <form class="actions kpi-actions" style="margin-top: 10px;">
                  <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <label style="font-weight: bold; color: #475569;">Rango de Fecha:</label>
                    <input type="text" id="hm-filtro-fecha" class="date-picker" placeholder="DD/MM/YYYY - DD/MM/YYYY"
                      style="width: 220px;" />

                    <label style="font-weight: bold; color: #475569; margin-left: 10px;">Unidad:</label>
                    <select id="hm-filtro-unidad"
                      style="padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; outline: none;">
                      <option value="">Todas las Unidades</option>
                    </select>

                    <button type="button" class="btn small" id="hm-btn-refresh">Aplicar</button>

                    <!-- Export Buttons with Premium Look -->
                    <button type="button" id="hm-btn-excel" title="Descargar reporte en Excel"
                      style="background-color: #10b981; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px; font-weight: 500; transition: background 0.2s;">
                      <span style="font-size: 16px;">üìä</span> Excel
                    </button>
                    <button type="button" id="hm-btn-pdf" title="Descargar reporte en PDF"
                      style="background-color: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px; font-weight: 500; transition: background 0.2s;">
                      <span style="font-size: 16px;">üìÑ</span> PDF
                    </button>
                  </div>
                </form>
              </div>

              <!-- KPI Cards -->
              <div class="kpi-stats-row" style="display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap;">
                <div class="kpi-card stat-card" style="flex: 1; min-width: 200px; text-align: center; padding: 20px;">
                  <h3 style="font-size: 14px; color: #64748b; text-transform: uppercase;">Cantidad de Incidencias</h3>
                  <div id="hm-kpi-total" style="font-size: 32px; font-weight: bold; color: #3b82f6; margin-top: 10px;">0
                  </div>
                </div>
                <div class="kpi-card stat-card" style="flex: 1; min-width: 200px; text-align: center; padding: 20px;">
                  <h3 style="font-size: 14px; color: #64748b; text-transform: uppercase;">Cantidad V. de Producto</h3>
                  <div id="hm-kpi-valor-producto"
                    style="font-size: 32px; font-weight: bold; color: #ef4444; margin-top: 10px;">S/ 0.00</div>
                </div>
                <div class="kpi-card stat-card" style="flex: 1; min-width: 200px; text-align: center; padding: 20px;">
                  <h3 style="font-size: 14px; color: #64748b; text-transform: uppercase;">Cantidad V. de Recupero</h3>
                  <div id="hm-kpi-valor-recupero"
                    style="font-size: 32px; font-weight: bold; color: #10b981; margin-top: 10px;">S/ 0.00</div>
                </div>
              </div>

              <!-- Grid de Gr√°ficos (Flexible) -->
              <div class="resumen-grid"
                style="margin-top: 20px; grid-template-columns: repeat(3, 1fr); grid-template-rows: 300px 300px; height: auto;">
                <!-- 1. Torta: Cantidad de registros por categor√≠a (tipoIncidente) -->
                <div class="kpi-card">
                  <h4>Incidentes por Categor√≠a</h4>
                  <canvas id="hm-chart-categoria"></canvas>
                </div>

                <!-- 2. Torta: Por sub categor√≠a (subCategoria) -->
                <div class="kpi-card">
                  <h4>Incidentes por Subcategor√≠a</h4>
                  <canvas id="hm-chart-subcategoria"></canvas>
                </div>

                <!-- 3. Barras: Por unidad (unidad) -->
                <div class="kpi-card">
                  <h4>Incidentes por Unidad</h4>
                  <canvas id="hm-chart-unidad"></canvas>
                </div>

                <!-- 5. Barras: Cantidad de incidentes registrados por fecha (fechaRegistro) -->
                <div class="kpi-card">
                  <h4>Incidentes por Fecha</h4>
                  <canvas id="hm-chart-fecha"></canvas>
                </div>

                <!-- 4. Lineas: Comparaci√≥n Valor Producto vs Valor Recuperaci√≥n (por mes) -->
                <div class="kpi-card" style="grid-column: span 2;">
                  <h4>Comparativo Valor: Producto vs Recuperado (Mensual)</h4>
                  <canvas id="hm-chart-valor"></canvas>
                </div>
              </div>

              <!-- Tabla de Detalles -->
              <div class="kpi-card" style="margin-top: 20px; overflow: hidden;">
                <h4 style="margin-bottom: 15px;">Detalle de Registros</h4>
                <div class="table-wrap" style="max-height: 400px; overflow-y: auto;">
                  <table id="hm-tabla-datos" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                    <thead style="background: #f1f5f9; position: sticky; top: 0;">
                      <tr>
                        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Fecha</th>
                        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Unidad</th>
                        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Persona que
                          Registr√≥</th>
                        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Categor√≠a</th>
                        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Sub Categor√≠a
                        </th>
                        <th style="padding: 10px; text-align: right; border-bottom: 2px solid #e2e8f0;">V. Producto</th>
                        <th style="padding: 10px; text-align: right; border-bottom: 2px solid #e2e8f0;">V. Recuperaci√≥n
                        </th>
                        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Observaciones
                        </th>
                      </tr>
                    </thead>
                    <tbody id="hm-tabla-body">
                      <!-- Filled by JS -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- PESTA√ëAS PLACEHOLDER RESTO -->
            <div id="kpi-ronda-general" class="kpi-subview">
              <!-- Filtros y Card de Info -->
              <div
                style="display: grid; grid-template-columns: 1fr auto; gap: 20px; margin-bottom: 24px; align-items: start;">

                <!-- Panel de Filtros -->
                <div
                  style="background: white; padding: 20px; border-radius: 14px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                  <h3
                    style="margin: 0 0 16px 0; font-size: 14px; font-weight: 700; color: #2d3748; text-transform: uppercase; letter-spacing: 0.5px;">
                    üîç Filtros</h3>

                  <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 12px;">
                    <!-- Cliente -->
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">üë•
                        Cliente</label>
                      <select id="kpi-ronda-cliente"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                        <option value="">Todos</option>
                      </select>
                    </div>

                    <!-- Unidad -->
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">üè¢
                        Unidad</label>
                      <select id="kpi-ronda-unidad"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                        <option value="">Todas</option>
                      </select>
                    </div>

                    <!-- Fecha Inicio -->
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">üìÖ
                        Fecha Inicio</label>
                      <input id="ronda-general-fecha-inicio" type="date"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                    </div>

                    <!-- Fecha Fin -->
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">üìÖ
                        Fecha Fin</label>
                      <input id="ronda-general-fecha-fin" type="date"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                    </div>

                    <!-- Botones -->
                    <div style="grid-column: 1 / -1; display: flex; gap: 8px; margin-top: 4px;">
                      <button id="kpi-ronda-aplicar"
                        style="flex: 1; padding: 10px 14px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease;">
                        Aplicar
                      </button>
                      <button id="kpi-ronda-limpiar"
                        style="flex: 1; padding: 10px 14px; background: #f7fafc; color: #4a5568; border: 1px solid #cbd5e0; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease;">
                        Limpiar
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Card de Informaci√≥n -->
                <div
                  style="background: linear-gradient(135deg, #f0f4ff 0%, #f5f8ff 100%); padding: 24px; border-radius: 14px; border: 2px solid #e0e7ff; min-width: 280px; text-align: center;">
                  <p
                    style="margin: 0 0 8px 0; font-size: 12px; font-weight: 600; color: #6366f1; text-transform: uppercase; letter-spacing: 0.5px;">
                    üìä Total de Registros</p>
                  <h2 id="kpi-ronda-total"
                    style="margin: 0 0 8px 0; font-size: 48px; font-weight: 800; color: #3b82f6; line-height: 1;">0</h2>
                  <p id="kpi-ronda-info-text" style="margin: 0; font-size: 12px; color: #64748b; line-height: 1.6;">
                    Registros del mes en curso</p>

                  <div
                    style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e0e7ff; font-size: 11px; color: #64748b;">
                    <span id="kpi-ronda-filter-info" style="display: block;">üîç Sin filtros aplicados</span>
                  </div>
                </div>
              </div>

              <!-- √Årea de Contenido (Gr√°ficos) -->
              <div id="kpi-ronda-general-content"
                style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px;">

                <!-- Gr√°fico de Torta - Estado de Rondas -->
                <div
                  style="background: white; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                  <h3 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 700; color: #2d3748;">üìä Estado de Rondas
                  </h3>
                  <canvas id="kpi-ronda-chart-estado" style="max-height: 300px;"></canvas>
                </div>

                <!-- Gr√°fico de Barras Laterales - Por Unidad/Estado -->
                <div
                  style="background: white; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                  <h3 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 700; color: #2d3748;">üìà Rondas por
                    Unidad</h3>
                  <canvas id="kpi-ronda-chart-unidades" style="max-height: 300px;"></canvas>
                </div>

                <!-- Gr√°fico de L√≠nea - Rondas por Fecha y Estado -->
                <div
                  style="background: white; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); grid-column: 1 / -1;">
                  <h3 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 700; color: #2d3748;">üìÖ Rondas por Fecha
                    y Estado</h3>
                  <canvas id="kpi-ronda-chart-fecha" style="max-height: 250px;"></canvas>
                </div>

                <!-- Tabla de Informaci√≥n Detallada -->
                <div
                  style="background: white; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); grid-column: 1 / -1; overflow-x: auto;">
                  <h3 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 700; color: #2d3748;">üìã Detalle de
                    Rondas</h3>
                  <table id="kpi-ronda-tabla" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                      <tr style="background: #f7fafc; border-bottom: 2px solid #e2e8f0;">
                        <th
                          style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                          Fecha</th>
                        <th
                          style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                          Hora Inicio</th>
                        <th
                          style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                          Unidad</th>
                        <th
                          style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                          Nombre de Ronda</th>
                        <th
                          style="padding: 12px; text-align: center; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                          QR Registrados</th>
                        <th
                          style="padding: 12px; text-align: center; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                          QR Sin Registrar</th>
                        <th style="padding: 12px; text-align: center; font-weight: 600; color: #2d3748;">Estado</th>
                      </tr>
                    </thead>
                    <tbody id="kpi-ronda-tabla-body">
                      <tr style="border-bottom: 1px solid #e2e8f0;">
                        <td colspan="7" style="padding: 20px; text-align: center; color: #a0aec0;">Cargando datos...
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div id="kpi-detalle-rondas" class="kpi-subview">
              <!-- Panel de Filtros -->
              <div
                style="display: grid; grid-template-columns: 1fr auto; gap: 20px; margin-bottom: 24px; align-items: start;">
                <div
                  style="background: white; padding: 20px; border-radius: 14px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                  <h3
                    style="margin: 0 0 16px 0; font-size: 14px; font-weight: 700; color: #2d3748; text-transform: uppercase; letter-spacing: 0.5px;">
                    üîç Filtros</h3>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <!-- Cliente -->
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">üë•
                        Cliente</label>
                      <select id="detalle-rondas-cliente"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                        <option value="">Todos</option>
                      </select>
                    </div>

                    <!-- Unidad -->
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">üè¢
                        Unidad</label>
                      <select id="detalle-rondas-unidad"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                        <option value="">Todas</option>
                      </select>
                    </div>

                    <!-- Fecha Inicio -->
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">üìÖ
                        Fecha Inicio</label>
                      <input id="detalle-rondas-fecha-inicio" type="date"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                    </div>

                    <!-- Fecha Fin -->
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">üìÖ
                        Fecha Fin</label>
                      <input id="detalle-rondas-fecha-fin" type="date"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                    </div>

                    <!-- Estado -->
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">üìä
                        Estado</label>
                      <select id="detalle-rondas-estado"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                        <option value="">Todos</option>
                        <option value="TERMINADA">Terminada</option>
                        <option value="INCOMPLETADA">Incompleta</option>
                        <option value="NO REALIZADA">No Realizada</option>
                      </select>
                    </div>

                    <!-- Botones -->
                    <div style="grid-column: 1 / -1; display: flex; gap: 8px; margin-top: 4px;">
                      <button id="detalle-rondas-aplicar"
                        style="flex: 1; padding: 10px 14px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease;">
                        Aplicar
                      </button>
                      <button id="detalle-rondas-limpiar"
                        style="flex: 1; padding: 10px 14px; background: #f7fafc; color: #4a5568; border: 1px solid #cbd5e0; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease;">
                        Limpiar
                      </button>
                      <button id="detalle-rondas-exportar"
                        style="flex: 0.8; padding: 10px 14px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease; white-space: nowrap;">
                        üìä Excel
                      </button>
                      <button id="detalle-rondas-pdf"
                        style="flex: 0.8; padding: 10px 14px; background: #ef4444; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease; white-space: nowrap;">
                        üìÑ PDF
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Card de Informaci√≥n -->
                <div
                  style="background: linear-gradient(135deg, #f0f4ff 0%, #f5f8ff 100%); padding: 24px; border-radius: 14px; border: 2px solid #e0e7ff; min-width: 280px; text-align: center;">
                  <p
                    style="margin: 0 0 8px 0; font-size: 12px; font-weight: 600; color: #6366f1; text-transform: uppercase; letter-spacing: 0.5px;">
                    üìã Total de Registros</p>
                  <h2 id="detalle-rondas-total"
                    style="margin: 0 0 8px 0; font-size: 48px; font-weight: 800; color: #3b82f6; line-height: 1;">0</h2>
                  <p id="detalle-rondas-info-text"
                    style="margin: 0; font-size: 12px; color: #64748b; line-height: 1.6;">Registros encontrados</p>
                </div>
              </div>

              <!-- Tabla de Detalle de Rondas -->
              <div
                style="background: white; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); overflow-x: auto;">
                <h3 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 700; color: #2d3748;">üìã Tabla de Rondas
                  Completadas</h3>
                <table id="detalle-rondas-tabla" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                  <thead>
                    <tr style="background: #f7fafc; border-bottom: 2px solid #e2e8f0;">
                      <th
                        style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                        Fecha</th>
                      <th
                        style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                        Hora Inicio</th>
                      <th
                        style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                        Hora T√©rmino</th>
                      <th
                        style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                        Cliente</th>
                      <th
                        style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                        Unidad</th>
                      <th
                        style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                        Nombre de Ronda</th>
                      <th
                        style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                        Usuario</th>
                      <th
                        style="padding: 12px; text-align: center; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                        QR Registrados</th>
                      <th
                        style="padding: 12px; text-align: center; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                        QR Sin Registrar</th>
                      <th
                        style="padding: 12px; text-align: center; font-weight: 600; color: #2d3748; border-right: 1px solid #e2e8f0;">
                        Estado</th>
                      <th style="padding: 12px; text-align: center; font-weight: 600; color: #2d3748; width: 80px;">
                        Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="detalle-rondas-tabla-body">
                    <tr style="border-bottom: 1px solid #e2e8f0;">
                      <td colspan="9" style="padding: 20px; text-align: center; color: #a0aec0;">Cargando datos...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- DETALLE ACCESO DASHBOARD -->
            <div id="kpi-detalle-acceso" class="kpi-subview">
              <div class="da-container">
                <!-- FILTROS -->
                <div class="da-filters">
                  <div class="da-filter-group">
                    <label>Rango de Fecha</label>
                    <input type="text" id="da-fecha" class="date-range-input" placeholder="Seleccionar fechas" />
                  </div>
                  <div class="da-filter-group">
                    <label>Cliente</label>
                    <select id="da-cliente" class="filter-select">
                      <option value="__ALL__">Todos</option>
                    </select>
                  </div>
                  <div class="da-filter-group">
                    <label>Unidad</label>
                    <select id="da-unidad" class="filter-select">
                      <option value="__ALL__">Todos</option>
                    </select>
                  </div>
                  <div class="da-filter-group">
                    <label>Tipo de Acceso</label>
                    <select id="da-tipo" class="filter-select">
                      <option value="__ALL__">Todos</option>
                    </select>
                  </div>
                  <div class="da-filter-group">
                    <label>Estado</label>
                    <select id="da-estado" class="filter-select">
                      <option value="__ALL__">Todos</option>
                    </select>
                  </div>
                  <button id="da-apply" class="btn-apply">Aplicar Filtros</button>
                  <button id="da-export" class="btn-export">üìä Exportar Excel</button>
                </div>

                <!-- CARDS RESUMEN -->
                <div class="da-summary-cards">
                  <div class="summary-card card-primary">
                    <div class="card-value" id="da-total">0</div>
                    <div class="card-label">Total Accesos</div>
                  </div>
                  <div class="summary-card card-visit">
                    <div class="card-value" id="da-visita">0</div>
                    <div class="card-label">Visitas</div>
                  </div>
                  <div class="summary-card card-provider">
                    <div class="card-value" id="da-proveedor">0</div>
                    <div class="card-label">Proveedores</div>
                  </div>
                  <div class="summary-card card-contractor">
                    <div class="card-value" id="da-contratista">0</div>
                    <div class="card-label">Contratistas</div>
                  </div>
                  <div class="summary-card card-employee">
                    <div class="card-value" id="da-empleado">0</div>
                    <div class="card-label">Empleados</div>
                  </div>
                </div>

                <!-- GR√ÅFICOS PRINCIPALES -->
                <div class="da-charts-grid">
                  <!-- L√≠nea: Accesos por Fecha -->
                  <div class="chart-container chart-full">
                    <h4>üìà Accesos por Fecha</h4>
                    <canvas id="da-chart-fecha"></canvas>
                  </div>

                  <!-- Pie: Distribuci√≥n por Tipo -->
                  <div class="chart-container chart-half">
                    <h4>ü•ß Distribuci√≥n por Tipo</h4>
                    <canvas id="da-chart-tipo"></canvas>
                  </div>

                  <!-- Bar: Top Clientes -->
                  <div class="chart-container chart-half">
                    <h4>üè¢ Top Clientes</h4>
                    <canvas id="da-chart-clientes"></canvas>
                  </div>

                  <!-- Doughnut: Estado Accesos -->
                  <div class="chart-container chart-half">
                    <h4>‚úÖ Estado de Accesos</h4>
                    <canvas id="da-chart-estado"></canvas>
                  </div>

                  <!-- Bar: Accesos por Unidad -->
                  <div class="chart-container chart-half">
                    <h4>üè™ Accesos por Unidad</h4>
                    <canvas id="da-chart-unidad"></canvas>
                  </div>

                  <!-- Heatmap: Por Empresa -->
                  <div class="chart-container chart-full">
                    <h4>üè≠ Accesos por Empresa</h4>
                    <canvas id="da-chart-empresa"></canvas>
                  </div>
                </div>

                <!-- TABLA DETALLADA -->
                <div class="da-table-section">
                  <h3>üìã Detalle de Accesos</h3>
                  <div class="table-controls">
                    <input type="text" id="da-search" placeholder="üîç Buscar por cliente, unidad, usuario..."
                      class="search-input" />
                    <select id="da-sort" class="sort-select">
                      <option value="fecha-desc">M√°s Recientes</option>
                      <option value="fecha-asc">M√°s Antiguos</option>
                      <option value="cliente">Por Cliente</option>
                    </select>
                  </div>
                  <table id="da-table" class="detail-table">
                    <thead>
                      <tr>
                        <th>Fecha Ingreso</th>
                        <th>Cliente</th>
                        <th>Unidad</th>
                        <th>Tipo</th>
                        <th>Usuario</th>
                        <th>Empresa</th>
                        <th>Estado</th>
                        <th>Duraci√≥n</th>
                      </tr>
                    </thead>
                    <tbody id="da-tbody">
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- CONTROL VEHICULAR -->
            <div id="kpi-control-vehicular" class="kpi-subview">
              <div class="cv-container">
                <!-- FILTROS -->
                <div class="cv-filters"
                  style="background: white; padding: 20px; border-radius: 14px; border: 1px solid #e2e8f0; margin-bottom: 20px;">
                  <h3 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 700; color: #2d3748;">üîç Filtros</h3>
                  <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px;">
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">Fecha
                        Inicio</label>
                      <input type="date" id="cv-fecha-inicio"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px;">
                    </div>
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">Fecha
                        Fin</label>
                      <input type="date" id="cv-fecha-fin"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px;">
                    </div>
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">Cliente</label>
                      <select id="cv-cliente"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                        <option value="">Todos</option>
                      </select>
                    </div>
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">Unidad</label>
                      <select id="cv-unidad"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                        <option value="">Todas</option>
                      </select>
                    </div>
                    <div>
                      <label
                        style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">Estado</label>
                      <select id="cv-estado"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                        <option value="">Todos</option>
                        <option value="salida">Salidas Autorizadas</option>
                        <option value="ingreso">Pendiente de Salida</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button type="button" id="cv-btn-buscar"
                        style="flex: 1; padding: 10px 14px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer;">Buscar</button>
                      <button type="button" id="cv-btn-limpiar"
                        style="flex: 1; padding: 10px 14px; background: #f7fafc; color: #4a5568; border: 1px solid #cbd5e0; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer;">Limpiar</button>
                    </div>
                  </div>
                  <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 12px;">
                    <button type="button" id="cv-btn-excel"
                      style="padding: 10px 14px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer;">üìä
                      Exportar Excel</button>
                    <button type="button" id="cv-btn-pdf"
                      style="padding: 10px 14px; background: #ef4444; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer;">üìÑ
                      Exportar PDF</button>
                  </div>
                </div>

                <!-- CARDS RESUMEN -->
                <div
                  style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                  <div
                    style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #3b82f6; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="font-size: 28px; font-weight: 800; color: #3b82f6;" id="cv-total">0</div>
                    <div style="font-size: 12px; color: #718096; margin-top: 4px;">Total Accesos Vehiculares</div>
                  </div>
                  <div
                    style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #10b981; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="font-size: 28px; font-weight: 800; color: #10b981;" id="cv-ingresados">0</div>
                    <div style="font-size: 12px; color: #718096; margin-top: 4px;">Ingresados</div>
                  </div>
                  <div
                    style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="font-size: 28px; font-weight: 800; color: #f59e0b;" id="cv-pendientes">0</div>
                    <div style="font-size: 12px; color: #718096; margin-top: 4px;">Pendientes de Salida</div>
                  </div>
                  <div
                    style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #8b5cf6; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="font-size: 28px; font-weight: 800; color: #8b5cf6;" id="cv-salidas">0</div>
                    <div style="font-size: 12px; color: #718096; margin-top: 4px;">Salidas</div>
                  </div>
                </div>

                <!-- GR√ÅFICOS -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                  <div
                    style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); max-height: 350px;">
                    <h4 style="margin: 0 0 16px 0; color: #2d3748;">üìà Accesos por Fecha</h4>
                    <div style="position: relative; height: 250px;">
                      <canvas id="cv-chart-fecha"></canvas>
                    </div>
                  </div>
                  <div
                    style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); max-height: 350px;">
                    <h4 style="margin: 0 0 16px 0; color: #2d3748;">ü•ß Distribuci√≥n por Estado</h4>
                    <div style="position: relative; height: 250px;">
                      <canvas id="cv-chart-estado"></canvas>
                    </div>
                  </div>
                </div>

                <!-- TABLA DETALLADA -->
                <div
                  style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow-x: auto;">
                  <h3 style="margin: 0 0 16px 0; color: #2d3748;">üìã Detalle de Accesos Vehiculares</h3>
                  <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                      <tr style="background-color: #2c5aa0; color: white;">
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Fecha/Hora
                          Ingreso</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Fecha/Hora Salida
                        </th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Placa</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Cliente</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Unidad</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Puesto</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Usuario Ingreso
                        </th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Usuario Salida
                        </th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Estado</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Observaciones
                          Ingreso</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Observaciones
                          Salida</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Imagen</th>
                      </tr>
                    </thead>
                    <tbody id="cv-tbody" style="background: white;">
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- PESTA√ëA 8: INCIDENCIA QR -->
            <div id="kpi-incidencia-qr" class="kpi-subview" role="tabpanel">
              <div
                style="background: white; padding: 20px; border-radius: 14px; border: 1px solid #e2e8f0; margin-bottom: 20px;">
                <h3
                  style="margin: 0 0 16px 0; font-size: 14px; font-weight: 700; color: #2d3748; text-transform: uppercase;">
                  üîç Filtros</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                  <div>
                    <label
                      style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">Fecha
                      Inicio</label>
                    <input type="date" id="iqr-fecha-inicio"
                      style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px;">
                  </div>
                  <div>
                    <label
                      style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">Fecha
                      Fin</label>
                    <input type="date" id="iqr-fecha-fin"
                      style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px;">
                  </div>
                  <div>
                    <label
                      style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">Cliente</label>
                    <select id="iqr-cliente"
                      style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                      <option value="">Todos</option>
                    </select>
                  </div>
                  <div>
                    <label
                      style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: #4a5568; text-transform: uppercase;">Unidad</label>
                    <select id="iqr-unidad"
                      style="width: 100%; padding: 10px 12px; border: 1px solid #cbd5e0; border-radius: 8px; font-size: 13px; background: white; cursor: pointer;">
                      <option value="">Todas</option>
                    </select>
                  </div>
                  <div style="display: flex; gap: 8px; align-items: flex-end;">
                    <button type="button" id="iqr-btn-aplicar"
                      style="flex: 1; padding: 10px 14px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease;">Aplicar</button>
                    <button type="button" id="iqr-btn-limpiar"
                      style="flex: 1; padding: 10px 14px; background: #f7fafc; color: #4a5568; border: 1px solid #cbd5e0; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease;">Limpiar</button>
                  </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 12px;">
                  <button type="button" id="iqr-btn-excel"
                    style="padding: 10px 14px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer;">üìä
                    Exportar Excel</button>
                  <button type="button" id="iqr-btn-pdf"
                    style="padding: 10px 14px; background: #ef4444; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer;">üìÑ
                    Exportar PDF</button>
                </div>
              </div>

              <!-- CARDS RESUMEN -->
              <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                <div
                  style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #3b82f6; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                  <div style="font-size: 28px; font-weight: 800; color: #3b82f6;" id="iqr-total">0</div>
                  <div style="font-size: 12px; color: #718096; margin-top: 4px;">Cantidad de Registros</div>
                </div>
              </div>

              <!-- GR√ÅFICOS -->
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                <div
                  style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                  <h4 style="margin: 0 0 16px 0; color: #2d3748;">üìà Incidencias por Fecha</h4>
                  <div style="position: relative; height: 300px;">
                    <canvas id="iqr-chart-fecha"></canvas>
                  </div>
                </div>
                <div
                  style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                  <h4 style="margin: 0 0 16px 0; color: #2d3748;">ü•ß Cantidad de Incidencias por Punto</h4>
                  <div style="position: relative; height: 300px;">
                    <canvas id="iqr-chart-estado"></canvas>
                  </div>
                </div>
              </div>

              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                <div
                  style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                  <h4 style="margin: 0 0 16px 0; color: #2d3748;">üë§ Cantidad de Registros por Usuario</h4>
                  <div style="position: relative; height: 300px;">
                    <canvas id="iqr-chart-cliente"></canvas>
                  </div>
                </div>
                <div
                  style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                  <h4 style="margin: 0 0 16px 0; color: #2d3748;">üè¢ Incidencias por Unidad</h4>
                  <div style="position: relative; height: 300px;">
                    <canvas id="iqr-chart-unidad"></canvas>
                  </div>
                </div>
              </div>

              <!-- TABLA DETALLADA -->
              <div
                style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow-x: auto;">
                <h3 style="margin: 0 0 16px 0; color: #2d3748;">üìã Detalle de Rondas Manuales</h3>
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                  <thead>
                    <tr style="background-color: #2c5aa0; color: white;">
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Fecha/Hora</th>
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Usuario</th>
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Cliente</th>
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Unidad</th>
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">QR</th>
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Pregunta</th>
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Respuesta</th>
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Puesto</th>
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Punto de Control
                      </th>
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Estado</th>
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #1e3a5f;">Foto</th>
                    </tr>
                  </thead>
                  <tbody id="iqr-tbody" style="background: white;">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div id="view-usuarios" class="view">
          <div class="page">
            <div class="page-head">
              <h2>Usuarios <small class="muted" id="usersCount"></small></h2>
              <h2 id="users-title">Usuarios <small class="muted" id="usersCount"></small></h2>
            </div>
            <!-- Filtros de b√∫squeda predictivos -->
            <div
              style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 16px; padding: 12px; background: #f5f7fa; border-radius: 8px;">
              <input type="text" id="filter-id" placeholder="üîç ID..."
                style="padding: 8px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 13px;" />
              <input type="text" id="filter-nombres" placeholder="üîç Nombres..."
                style="padding: 8px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 13px;" />
              <input type="text" id="filter-apellidos" placeholder="üîç Apellidos..."
                style="padding: 8px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 13px;" />
              <input type="text" id="filter-cliente" placeholder="üîç Cliente..."
                style="padding: 8px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 13px;" />
              <input type="text" id="filter-unidad" placeholder="üîç Unidad..."
                style="padding: 8px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 13px;" />
              <input type="text" id="filter-tipo" placeholder="üîç Tipo..."
                style="padding: 8px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 13px;" />
              <input type="text" id="filter-estado" placeholder="üîç Estado..."
                style="padding: 8px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 13px;" />
              <button type="button" id="clear-filters" class="btn secondary" style="padding: 8px; font-size: 13px;">üîÑ
                Limpiar</button>
            </div>
            <div class="table-wrap">
              <table class="data-table" id="usersTable" aria-label="Usuarios">
                <table class="data-table" id="usersTable" aria-labelledby="users-title">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Nombres</th>
                      <th>Apellidos</th>
                      <th>Cliente</th>
                      <th>Unidad</th>
                      <th>Tipo</th>
                      <th>Estado</th>
                      <th style="width:140px">Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="usersTbody"></tbody>
                </table>
            </div>
            <!-- Paginaci√≥n Usuarios -->
            <div class="pagination-controls" id="users-pagination"
              style="display: flex; gap: 10px; align-items: center; justify-content: flex-end; margin-top: 15px; padding-right: 10px;">
              <button class="btn small secondary" id="btn-prev-users" disabled>Anterior</button>
              <span id="page-info-users" style="font-size: 13px; color: #4a5568;">P√°gina 1</span>
              <button class="btn small secondary" id="btn-next-users" disabled>Siguiente</button>
            </div>
          </div>
        </div>

        <!-- ===== CLIENTE / UNIDAD ===== -->
        <div id="view-cliente-unidad" class="view">
          <div class="page">
            <div class="page-head">
              <h2 id="cu-title">Gesti√≥n de Clientes y Unidades</h2>
              <div style="margin-left: auto; display: flex; gap: 10px;">
                <button id="cuAgregarClienteBtn" class="btn btn-primary" style="padding: 8px 16px; font-size: 14px;">+
                  Agregar CLIENTE</button>
                <button id="cuAgregarUnidadBtn" class="btn btn-primary" style="padding: 8px 16px; font-size: 14px;">+
                  Agregar UNIDAD</button>
                <button id="cuAgregarPuestoBtn" class="btn btn-primary" style="padding: 8px 16px; font-size: 14px;">+
                  Agregar PUESTO</button>
              </div>
            </div>
            <div class="search-bar" style="margin-bottom: 16px;">
              <input type="text" id="clienteUnidadSearchInput" placeholder="Buscar por cliente o unidad..." />
            </div>
            <div class="table-wrap">
              <table class="data-table" aria-labelledby="cu-title">
                <thead>
                  <tr>
                    <th>CLIENTE</th>
                    <th>UNIDAD</th>
                    <th>PUESTO</th>
                    <th style="width:140px">ACCIONES</th>
                  </tr>
                </thead>
                <tbody id="clienteUnidadTbody"></tbody>
              </table>
            </div>
            <!-- Paginaci√≥n Clientes/Unidades -->
            <div class="pagination-controls" id="cu-pagination"
              style="display: flex; gap: 10px; align-items: center; justify-content: flex-end; margin-top: 15px; padding-right: 10px;">
              <button class="btn small secondary" id="btn-prev-cu" disabled>Anterior</button>
              <span id="page-info-cu" style="font-size: 13px; color: #4a5568;">P√°gina 1</span>
              <button class="btn small secondary" id="btn-next-cu" disabled>Siguiente</button>
            </div>
          </div>
        </div>

        <!-- ===== CUADERNO ===== -->
        <div id="view-cuaderno" class="view">
          <div class="page">
            <div class="page-head">
              <h2 id="cuaderno-title">Cuaderno</h2>
            </div>
            <form class="filter-bar">
              <label>Fecha de inicio<input type="date" id="cuaderno-fecha-inicio" /></label>
              <label>Fecha de fin<input type="date" id="cuaderno-fecha-fin" /></label>
              <label>Cliente<select id="cuaderno-cliente"></select></label>
              <label>Unidad<select id="cuaderno-unidad"></select></label>
              <button type="button" class="btn" id="cuaderno-btn-buscar">Buscar</button>
              <button type="reset" class="btn secondary" id="cuaderno-btn-limpiar">Limpiar</button>
              <button type="button" class="btn secondary" id="cuaderno-btn-exportar">Exportar</button>
              <button type="button" class="btn secondary" id="cuaderno-btn-imprimir-pdf">Imprimir PDF</button>
            </form>
            <div class="table-wrap">
              <table class="data-table" aria-labelledby="cuaderno-title">
                <thead>
                  <tr>
                    <th style="width:150px;">FECHA</th>
                    <th>CLIENTE</th>
                    <th>UNIDAD</th>
                    <th>TIPO</th>
                    <th>USUARIO ENTRANTE</th>
                    <th>USUARIO SALIENTE</th>
                    <th>USUARIO</th>
                    <th>COMENTARIO</th>
                    <th>FOTO</th>
                  </tr>
                </thead>
                <tbody id="cuadernoTbody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== INCIDENCIAS ===== -->
        <div id="view-incidencias" class="view">
          <div class="page">
            <div class="page-head">
              <h2 id="incidencias-title">Incidencias</h2>
            </div>
            <form class="filter-bar">
              <label>Fecha inicio<input type="date" id="incidencias-fecha-inicio" /></label>
              <label>Fecha fin<input type="date" id="incidencias-fecha-fin" /></label>
              <label>Cliente<select id="incidencias-cliente"></select></label>
              <label>Unidad<select id="incidencias-unidad"></select></label>
              <label>Estado<select id="incidencias-estado"></select></label>
              <button type="button" class="btn" id="incidencias-btn-buscar">Buscar</button>
              <button type="reset" class="btn secondary" id="incidencias-btn-limpiar">Limpiar</button>
              <button type="button" class="btn secondary" id="incidencias-btn-exportar">Exportar Excel</button>
            </form>
            <div class="table-wrap">
              <table class="data-table" aria-labelledby="incidencias-title">
                <thead>
                  <tr>
                    <th style="width:150px;">FECHA</th>
                    <th>CLIENTE</th>
                    <th>UNIDAD</th>
                    <th>CATEGORIA</th>
                    <th>SUB CATEGORIA</th>
                    <th>NIVEL DE RIESGO</th>
                    <th>ESTADO</th>
                    <th>COMENTARIO</th>
                    <th style="width:90px;">ACCIONES</th>
                  </tr>
                </thead>
                <tbody id="incidenciasTbody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== TIEMPO DE CONEXI√ìN ===== -->
        <div id="view-tiempo-conexion" class="view">
          <div class="page">
            <div class="page-head">
              <h2 id="tiempo-conexion-title">‚è±Ô∏è Tiempo de Conexi√≥n</h2>
            </div>
            <form class="filter-bar">
              <label>Fecha inicio<input type="date" id="tiempo-conexion-fecha-inicio" /></label>
              <label>Fecha fin<input type="date" id="tiempo-conexion-fecha-fin" /></label>
              <label>Cliente<select id="tiempo-conexion-cliente"></select></label>
              <label>Unidad<select id="tiempo-conexion-unidad"></select></label>
              <label>Usuario<select id="tiempo-conexion-usuario"></select></label>
              <button type="button" class="btn" id="tiempo-conexion-btn-buscar">Buscar</button>
              <button type="reset" class="btn secondary" id="tiempo-conexion-btn-limpiar">Limpiar</button>
              <button type="button" class="btn secondary" id="tiempo-conexion-btn-exportar">Exportar Excel</button>
              <button type="button" class="btn secondary" id="tiempo-conexion-btn-pdf">Imprimir PDF</button>
            </form>
            <div class="table-wrap">
              <table class="data-table" aria-labelledby="tiempo-conexion-title">
                <thead>
                  <tr>
                    <th style="width:150px;">USUARIO</th>
                    <th style="width:120px;">CLIENTE</th>
                    <th style="width:120px;">UNIDAD</th>
                    <th style="width:150px;">FECHA</th>
                    <th style="width:120px;">HORA INICIO</th>
                    <th style="width:120px;">HORA FIN</th>
                    <th style="width:150px;">TIEMPO CONEXI√ìN</th>
                  </tr>
                </thead>
                <tbody id="tiempoConexionTbody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Crear QR -->
        <div id="view-crear-qr" class="view">
          <div class="page">
            <div class="page-head">
              <h2>üì± Generador de QR</h2>
            </div>
            <div class="page-content">

              <div class="modern-form-container">
                <!-- Secci√≥n Formulario -->
                <div class="modern-form-section">
                  <h2>‚ú® Crear Nuevo QR</h2>
                  <form id="qrForm">

                    <div class="form-group">
                      <label>Cliente <span class="required">*</span></label>
                      <select id="qr-cliente" required>
                        <option value="">Seleccionar Cliente</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label>Unidad <span class="required">*</span></label>
                      <select id="qr-unidad" required>
                        <option value="">Seleccionar Unidad</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label>Nombre <span class="required">*</span></label>
                      <input type="text" id="qr-nombre" placeholder="Ej: Puerta Principal, Almac√©n" required />
                    </div>

                    <!-- Se requiere pregunta -->
                    <div class="form-group">
                      <label>Se requiere pregunta <span class="required">*</span></label>
                      <select id="qr-require-question" required>
                        <option value="">Seleccionar</option>
                        <option value="no">No</option>
                        <option value="si">S√≠</option>
                      </select>
                    </div>

                    <!-- Preguntas (solo aparecen si se selecciona "S√≠") -->
                    <div id="qr-questions-container" style="display: none;">
                      <div class="form-group">
                        <label>Preguntas <span class="required">*</span> (M√°ximo 3)</label>
                        <div id="qr-questions-list"
                          style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 12px;">
                          <!-- Las preguntas se agregan din√°micamente aqu√≠ -->
                        </div>
                        <button type="button" class="btn-modern secondary" id="qr-btn-add-question"
                          style="display: none;">
                          ‚ûï Agregar Pregunta
                        </button>
                      </div>
                    </div>

                    <div class="form-group">
                      <label>Geolocalizaci√≥n <span class="required">*</span></label>
                      <div style="display: flex; gap: 8px; align-items: flex-end;">
                        <div style="flex: 1;">
                          <input type="number" id="qr-latitude" placeholder="Latitud" step="any" required />
                        </div>
                        <div style="flex: 1;">
                          <input type="number" id="qr-longitude" placeholder="Longitud" step="any" required />
                        </div>
                        <button type="button" class="btn-modern secondary" id="qr-get-location"
                          title="Obtener ubicaci√≥n actual">üìç</button>
                        <button type="button" class="btn-modern secondary" id="qr-open-map"
                          title="Abrir mapa">üó∫Ô∏è</button>
                      </div>
                    </div>

                    <div class="form-group">
                      <label>Tama√±o del QR (p√≠xeles)</label>
                      <div class="form-row">
                        <div>
                          <label
                            style="font-size: 12px; color: #718096; font-weight: 600; text-transform: none; letter-spacing: normal;">Ancho</label>
                          <input type="number" id="qr-width" value="200" min="50" max="500" />
                        </div>
                        <div>
                          <label
                            style="font-size: 12px; color: #718096; font-weight: 600; text-transform: none; letter-spacing: normal;">Alto</label>
                          <input type="number" id="qr-height" value="200" min="50" max="500" />
                        </div>
                      </div>
                    </div>

                    <div class="btn-group">
                      <button type="reset" class="btn-modern secondary" id="qr-btn-limpiar">üîÑ Limpiar</button>
                      <button type="submit" class="btn-modern primary" id="qr-btn-agregar">‚ûï Crear QR</button>
                    </div>
                  </form>
                </div>

                <!-- Secci√≥n Vista Previa -->
                <div class="modern-form-section">
                  <h2>üëÅÔ∏è Vista Previa</h2>
                  <div
                    style="display: flex; flex-direction: column; gap: 16px; flex: 1; justify-content: center; align-items: center;">
                    <div id="qr-preview-container" style="
                      background: white;
                      padding: 20px;
                      border-radius: 12px;
                      border: 2px dashed #cbd5e0;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      min-height: 300px;
                      width: 100%;
                    ">
                      <div style="text-align: center; color: #a0aec0;">
                        <div style="font-size: 32px; margin-bottom: 12px;">üìä</div>
                        <p style="margin: 0; font-weight: 600;">Completa el formulario</p>
                        <p style="margin: 4px 0 0 0; font-size: 12px;">La vista previa aparecer√° aqu√≠</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Secci√≥n de Resultados -->
              <div class="results-section" style="margin-top: 28px;">
                <h3>üìã QRs Generados</h3>

                <div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
                  <select id="qr-filter-cliente"
                    style="padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 10px; flex: 1; min-width: 150px;">
                    <option value="">Todos los Clientes</option>
                  </select>
                  <select id="qr-filter-unidad"
                    style="padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 10px; flex: 1; min-width: 150px;">
                    <option value="">Todas las Unidades</option>
                  </select>
                  <button type="button" class="btn-modern primary" id="qr-filter-search" style="white-space: nowrap;">üîç
                    Buscar</button>
                  <button type="button" class="btn-modern secondary" id="qr-filter-clear"
                    style="white-space: nowrap;">üîÑ Limpiar</button>
                </div>

                <div id="qrListContainer" class="items-grid">
                  <!-- Los QR generados se mostrar√°n aqu√≠ -->
                </div>

                <!-- Bot√≥n descargar PDF al final -->
                <div style="margin-top: 20px; display: flex; gap: 12px;">
                  <button type="button" class="btn-modern success" id="qr-download-all" style="flex: 1;">
                    üì• Descargar Todos los QRs en PDF
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Crear Rondas -->
        <div id="view-crear-rondas" class="view">
          <div class="page">
            <div class="page-head">
              <h2 data-form-title>‚è∞ Crear Nueva Ronda</h2>
            </div>
            <div class="page-content">

              <div class="modern-form-container">
                <!-- Secci√≥n Formulario -->
                <div class="modern-form-section">
                  <h2>üéØ Configurar Ronda</h2>
                  <form id="crearRondaForm">

                    <!-- Cliente y Unidad -->
                    <div class="form-step-header">
                      <div class="form-step-badge">1</div>
                      <p class="form-step-label">Paso 1 - Ubicaci√≥n</p>
                    </div>
                    <div class="form-step-content">
                      <div class="form-row">
                        <div class="form-group">
                          <label>Cliente <span class="required">*</span></label>
                          <select id="ronda-cliente" required>
                            <option value="">Seleccionar Cliente</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label>Unidad <span class="required">*</span></label>
                          <select id="ronda-unidad" required>
                            <option value="">Seleccionar Unidad</option>
                          </select>
                        </div>
                      </div>
                    </div>

                    <!-- Nombre de la Ronda -->
                    <div class="form-step-header">
                      <div class="form-step-badge">2</div>
                      <p class="form-step-label">Paso 2 - Informaci√≥n</p>
                    </div>
                    <div class="form-step-content">
                      <div class="form-group">
                        <label>Nombre de la Ronda <span class="required">*</span></label>
                        <input type="text" id="ronda-nombre" placeholder="Ej: Ronda Matutina, Ronda Nocturna"
                          required />
                      </div>
                    </div>

                    <!-- Horarios -->
                    <div class="form-step-header">
                      <div class="form-step-badge">3</div>
                      <p class="form-step-label">Paso 3 - Horarios</p>
                    </div>
                    <div class="form-step-content">
                      <div class="form-row">
                        <div class="form-group">
                          <label>Hora de Inicio <span class="required">*</span></label>
                          <input type="time" id="ronda-horario" required />
                        </div>
                        <div class="form-group">
                          <label>Tolerancia <span class="required">*</span></label>
                          <div style="display: flex; gap: 8px;">
                            <input type="number" id="ronda-tolerancia" placeholder="15" min="0" max="1440" required />
                            <select id="ronda-tolerancia-tipo" style="min-width: 100px;">
                              <option value="minutos">Minutos</option>
                              <option value="horas">Horas</option>
                            </select>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Frecuencia -->
                    <div class="form-step-header">
                      <div class="form-step-badge">4</div>
                      <p class="form-step-label">Paso 4 - Frecuencia</p>
                    </div>
                    <div class="form-step-content">
                      <div class="form-group">
                        <label>Tipo de Frecuencia <span class="required">*</span></label>
                        <select id="ronda-frecuencia" required>
                          <option value="">Seleccionar Frecuencia</option>
                          <option value="diaria">üìÖ Diaria</option>
                          <option value="semanal">üìÜ Semanal</option>
                          <option value="mensual">üìã Mensual</option>
                          <option value="dias-especificos">üéØ D√≠as Espec√≠ficos</option>
                        </select>
                      </div>

                      <!-- D√≠as de la semana (solo para semanal) -->
                      <div id="rondaDiasSemanales" style="display: none; margin-top: 12px;">
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Selecciona los
                          d√≠as:</label>
                        <div class="checkbox-group">
                          <label class="checkbox-item">
                            <input type="checkbox" name="dia-semana" value="lunes" />
                            <span>Lunes</span>
                          </label>
                          <label class="checkbox-item">
                            <input type="checkbox" name="dia-semana" value="martes" />
                            <span>Martes</span>
                          </label>
                          <label class="checkbox-item">
                            <input type="checkbox" name="dia-semana" value="mi√©rcoles" />
                            <span>Mi√©rcoles</span>
                          </label>
                          <label class="checkbox-item">
                            <input type="checkbox" name="dia-semana" value="jueves" />
                            <span>Jueves</span>
                          </label>
                          <label class="checkbox-item">
                            <input type="checkbox" name="dia-semana" value="viernes" />
                            <span>Viernes</span>
                          </label>
                          <label class="checkbox-item">
                            <input type="checkbox" name="dia-semana" value="s√°bado" />
                            <span>S√°bado</span>
                          </label>
                          <label class="checkbox-item">
                            <input type="checkbox" name="dia-semana" value="domingo" />
                            <span>Domingo</span>
                          </label>
                        </div>
                      </div>

                      <!-- D√≠as del mes (solo para d√≠as espec√≠ficos) -->
                      <div id="rondaDiasMes" style="display: none; margin-top: 12px;">
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Ingresa los d√≠as del mes
                          (1-31):</label>
                        <input type="text" id="ronda-dias-mes" placeholder="Ej: 1,5,10,15,20,25" style="width: 100%;" />
                        <small style="color: #718096; display: block; margin-top: 4px;">Separados por comas</small>
                      </div>
                    </div>

                    <div class="btn-group">
                      <button type="reset" class="btn-modern secondary" id="ronda-btn-limpiar">üîÑ Limpiar</button>
                      <button type="submit" class="btn-modern primary" id="ronda-btn-crear">‚ûï Crear Ronda</button>
                      <button type="button" class="btn-modern danger" id="ronda-btn-cancelar" style="display: none;">‚úï
                        Cancelar Edici√≥n</button>
                    </div>
                  </form>
                </div>

                <!-- Secci√≥n Puntos de Ronda -->
                <div class="modern-form-section">
                  <h2>üìç Puntos de Ronda</h2>
                  <div id="rondaPuntosContainer" style="
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                    padding: 16px;
                    background: white;
                    border-radius: 12px;
                    border: 2px dashed #cbd5e0;
                    max-height: 500px;
                    overflow-y: auto;
                    flex: 1;
                  ">
                    <div style="text-align: center; color: #a0aec0; padding: 40px 20px;">
                      <div style="font-size: 32px; margin-bottom: 12px;">üìç</div>
                      <p style="margin: 0; font-weight: 600;">Selecciona cliente y unidad</p>
                      <p style="margin: 4px 0 0 0; font-size: 12px;">Los puntos QR aparecer√°n aqu√≠</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Secci√≥n de Rondas Creadas -->
              <div class="results-section" style="margin-top: 28px;">
                <h3>üìã Rondas Creadas</h3>

                <!-- Filtros de Rondas Creadas -->
                <div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
                  <select id="rondas-filter-cliente"
                    style="padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 10px; flex: 1; min-width: 150px;">
                    <option value="">Todos los Clientes</option>
                  </select>
                  <select id="rondas-filter-unidad"
                    style="padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 10px; flex: 1; min-width: 150px;">
                    <option value="">Todas las Unidades</option>
                  </select>
                  <button type="button" class="btn-modern primary" id="rondas-filter-search"
                    style="white-space: nowrap;">üîç Buscar</button>
                  <button type="button" class="btn-modern secondary" id="rondas-filter-clear"
                    style="white-space: nowrap;">üîÑ Limpiar</button>
                </div>

                <div id="rondasListContainer" style="display: grid; gap: 16px;">
                  <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <p>No hay rondas creadas a√∫n</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== TIPO INCIDENCIAS (NUEVO) ===== -->
        <div id="view-tipo-incidencias" class="view">
          <div class="page-head">
            <h2>Gesti√≥n de Tipos de Incidencias</h2>
            <p class="muted">Administra las categor√≠as y subcategor√≠as de incidencias por unidad.</p>
          </div>

          <!-- Filtros de Selecci√≥n -->
          <div class="card" style="margin-bottom: 20px; padding: 20px;">
            <div class="grid-2">
              <label class="field">
                <span>Cliente</span>
                <select id="ti-cliente">
                  <option value="">Seleccione Cliente</option>
                </select>
              </label>
              <label class="field">
                <span>Unidad</span>
                <select id="ti-unidad" disabled>
                  <option value="">Seleccione Unidad</option>
                </select>
              </label>
            </div>
            <div style="margin-top: 15px; display: flex; justify-content: flex-end;">
              <button type="button" class="btn primary" id="ti-btn-cargar">
                <span class="icon">üîç</span> Cargar Tipos
              </button>
            </div>
          </div>

          <!-- Contenido Principal (Grid 2 Columnas) -->
          <div id="ti-content" style="display: none; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start;">

            <!-- COl 1: LISTA DE CATEGOR√çAS (TIPO) -->
            <div class="card"
              style="padding: 0; overflow: hidden; display: flex; flex-direction: column; max-height: 600px;">
              <div
                style="padding: 15px 20px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600;">Categor√≠as</h3>
                <button type="button" class="btn small" id="ti-btn-add-cat">+ Nueva</button>
              </div>
              <div id="ti-cat-list" style="overflow-y: auto; flex: 1; padding: 10px;">
                <!-- Lista de categor√≠as inyectada por JS -->
                <div class="empty-state">Seleccione una unidad para ver categor√≠as</div>
              </div>
            </div>

            <!-- COl 2: DETALLES DE LA CATEGOR√çA (ARRAY DETALLES) -->
            <div class="card" id="ti-details-card" style="display: none; padding: 20px;">
              <div
                style="border-bottom: 1px solid #e2e8f0; padding-bottom: 15px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: start;">
                <div>
                  <h3 id="ti-detail-title" style="margin: 0 0 5px 0;">Categor√≠a</h3>
                  <p class="muted" style="margin: 0; font-size: 13px;">Lista de sub-tipos habilitados</p>
                </div>
                <button type="button" class="btn icon-btn danger" id="ti-btn-del-cat"
                  title="Eliminar Categor√≠a Completa">
                  üóëÔ∏è
                </button>
              </div>

              <!-- Lista de Subtipos -->
              <ul id="ti-subcat-list" style="list-style: none; padding: 0; margin: 0 0 20px 0;">
                <!-- Items inyectados por JS -->
              </ul>

              <!-- Agregar Nuevo Subtipo -->
              <form id="ti-form-add-sub" style="display: flex; gap: 10px;">
                <input type="text" id="ti-new-sub" placeholder="Nombre del sub-tipo..."
                  style="flex: 1; padding: 8px; border: 1px solid #cbd5e0; border-radius: 6px;" autocomplete="off" />
                <button type="submit" class="btn secondary">Agregar</button>
              </form>
            </div>

          </div>
        </div>

      </section>
    </main>
  </div>

  <!-- Overlay/loader (√∫nico) -->
  <div class="overlay" id="overlay" aria-hidden="true" aria-live="polite">
    <div class="ol-card" role="status">
      <div class="ol-anim" aria-hidden="true">
        <span class="ring one"></span><span class="ring two"></span><span class="ring three"></span>
      </div>
      <h3 class="ol-title" id="olTitle">Cargando sistema‚Ä¶</h3>
      <p class="ol-sub" id="olSub">Verificando sesi√≥n y datos</p>
      <div class="ol-bar" aria-hidden="true"><span id="olBar" style="width:0%"></span></div>
    </div>
  </div>

  <!-- Modales / Di√°logo / Toast -->
  <div class="modal" id="editModal" aria-hidden="true" role="dialog" aria-labelledby="editTitle" aria-modal="true">
    <div class="modal-box">
      <h3 id="editTitle">Editar usuario</h3>
      <form id="editForm">
        <div class="grid-2">
          <label>Nombres <input type="text" id="editNombres" required /></label>
          <label>Apellidos <input type="text" id="editApellidos" required /></label>
          <label>Cliente <select id="editCliente" required></select></label>
          <label>Unidad <select id="editUnidad" required></select></label>
          <label>Tipo<select id="editTipo" required>
              <option value="AGENTE">AGENTE</option>
              <option value="SUPERVISOR">SUPERVISOR</option>
              <option value="ADMIN">ADMIN</option>
            </select></label>
          <label>Estado<select id="editEstado" required>
              <option value="ACTIVO">ACTIVO</option>
              <option value="INACTIVO">INACTIVO</option>
            </select></label>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn secondary" id="editCancel">Cancelar</button>
          <button type="submit" class="btn" id="editSave">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal" id="cuEditModal" aria-hidden="true" role="dialog" aria-labelledby="cuEditTitle" aria-modal="true">
    <div class="modal-box">
      <h3 id="cuEditTitle">Editar Registro Cliente/Unidad</h3>
      <form id="cuEditForm">
        <input type="hidden" id="cuEditClienteOriginal" />
        <input type="hidden" id="cuEditUnidadOriginal" />
        <input type="hidden" id="cuEditPuestoOriginal" />
        <div class="grid-2">
          <label>Cliente <input type="text" id="cuEditCliente" required /></label>
          <label>Unidad <input type="text" id="cuEditUnidad" required /></label>
        </div>
        <div>
          <label>Puesto <input type="text" id="cuEditPuesto" placeholder="Ej: CAT" required /></label>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn secondary" id="cuEditCancel">Cancelar</button>
          <button type="submit" class="btn" id="cuEditSave">Guardar Cambios</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para agregar nuevo CLIENTE -->
  <div class="modal" id="cuAgregarClienteModal" aria-hidden="true" role="dialog" aria-labelledby="cuAgregarClienteTitle"
    aria-modal="true">
    <div class="modal-box">
      <h3 id="cuAgregarClienteTitle">Agregar Nuevo CLIENTE</h3>
      <form id="cuAgregarClienteForm">
        <div class="grid-2">
          <label>Nombre del Cliente <input type="text" id="cuNuevoCliente" placeholder="Ej: LIDERMAN"
              required /></label>
          <label>Primera Unidad <input type="text" id="cuNuevaUnidadCliente" placeholder="Ej: CHORRILLOS"
              required /></label>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn secondary" id="cuAgregarClienteCancel">Cancelar</button>
          <button type="submit" class="btn" id="cuAgregarClienteSave">Crear Cliente</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para agregar UNIDAD a cliente existente -->
  <div class="modal" id="cuAgregarUnidadModal" aria-hidden="true" role="dialog" aria-labelledby="cuAgregarUnidadTitle"
    aria-modal="true">
    <div class="modal-box">
      <h3 id="cuAgregarUnidadTitle">Agregar UNIDAD a Cliente</h3>
      <form id="cuAgregarUnidadForm">
        <div>
          <label>Seleccionar Cliente
            <select id="cuAgregarUnidadCliente" required>
              <option value="">-- Seleccionar Cliente --</option>
            </select>
          </label>
          <label>Nueva Unidad <input type="text" id="cuNuevaUnidad" placeholder="Ej: LINCE" required /></label>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn secondary" id="cuAgregarUnidadCancel">Cancelar</button>
          <button type="submit" class="btn" id="cuAgregarUnidadSave">Agregar Unidad</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para agregar PUESTO a unidad -->
  <div class="modal" id="cuAgregarPuestoModal" aria-hidden="true" role="dialog" aria-labelledby="cuAgregarPuestoTitle"
    aria-modal="true">
    <div class="modal-box">
      <h3 id="cuAgregarPuestoTitle">Agregar PUESTO a Unidad</h3>
      <form id="cuAgregarPuestoForm">
        <div>
          <label>Seleccionar Cliente
            <select id="cuAgregarPuestoCliente" required>
              <option value="">-- Seleccionar Cliente --</option>
            </select>
          </label>
          <label>Seleccionar Unidad
            <select id="cuAgregarPuestoUnidad" required>
              <option value="">-- Seleccionar Unidad --</option>
            </select>
          </label>
          <label>Nuevo Puesto <input type="text" id="cuNuevoPuesto" placeholder="Ej: CAT" required /></label>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn secondary" id="cuAgregarPuestoCancel">Cancelar</button>
          <button type="submit" class="btn" id="cuAgregarPuestoSave">Agregar Puesto</button>
        </div>
      </form>
    </div>
  </div>

  <div class="dialog" id="dialog" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="dialogTitle">
    <div class="dialog-box">
      <div class="dialog-icon" id="dialogIcon" aria-hidden="true">!</div>
      <h3 id="dialogTitle">T√≠tulo</h3>
      <p id="dialogMessage" class="muted">Mensaje‚Ä¶</p>
      <div class="dialog-actions" id="dialogActions"></div>
    </div>
  </div>

  <div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

  <!-- ===== Scripts (sin duplicados) ===== -->
  <!-- Firebase compat (v9.23.0) - DEBE cargarse primero -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-functions-compat.js"></script>

  <!-- Firebase config propio - DESPU√âS de los scripts de Firebase -->
  <script src="firebase-config.js"></script>

  <!-- jQuery + Moment + DateRangePicker -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

  <!-- Choices.js -->
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

  <!-- Leaflet Map -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-control-geocoder/2.2.9/Control.Geocoder.js"></script>

  <!-- Chart.js 4 + plugins -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@1"></script>

  <!-- Excel Export (XLSX) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- QR Code Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <!-- Modal del Mapa de Ubicaci√≥n -->
  <div id="qr-map-modal" class="qr-map-modal" style="display: none;">
    <div class="qr-map-modal-content">
      <div class="qr-map-header">
        <h3>üìç Seleccionar Ubicaci√≥n</h3>
        <button type="button" class="qr-map-close" id="qr-map-close">&times;</button>
      </div>

      <div class="qr-map-body">
        <!-- B√∫squeda mejorada -->
        <div class="qr-search-box"
          style="background: #f8f9ff; padding: 16px; border-radius: 12px; margin-bottom: 16px;">
          <label
            style="display: block; margin-bottom: 12px; font-weight: 600; font-size: 13px; color: #2d3748; text-transform: uppercase;">B√∫squeda
            Avanzada:</label>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
            <div>
              <label
                style="display: block; font-size: 12px; color: #718096; font-weight: 600; margin-bottom: 6px;">Buscar
                por:</label>
              <select id="qr-search-type"
                style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; background: white; font-size: 13px;">
                <option value="address">Direcci√≥n</option>
                <option value="company">Empresa</option>
                <option value="poi">Lugar Importante</option>
                <option value="coordinates">Coordenadas</option>
              </select>
            </div>
            <div>
              <label
                style="display: block; font-size: 12px; color: #718096; font-weight: 600; margin-bottom: 6px;">Provincia/Estado:</label>
              <select id="qr-search-province"
                style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; background: white; font-size: 13px;">
                <option value="">Seleccionar regi√≥n</option>
                <option value="lima">Lima</option>
                <option value="cusco">Cusco</option>
                <option value="arequipa">Arequipa</option>
                <option value="puno">Puno</option>
                <option value="otro">Otro pa√≠s</option>
              </select>
            </div>
          </div>

          <div style="display: flex; gap: 8px; margin-bottom: 12px;">
            <input type="text" id="qr-address-search" placeholder="Ej: Puerta Principal, Lima, Per√∫..."
              style="flex: 1; padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 8px; background: white; font-size: 13px;" />
            <button type="button" id="qr-search-btn"
              style="padding: 8px 14px; border: none; border-radius: 8px; background: #3b82f6; color: white; font-weight: 600; cursor: pointer; font-size: 12px; white-space: nowrap;">üîç
              Buscar</button>
          </div>
        </div>

        <!-- Selector de capas de mapa -->
        <div style="background: #f8f9ff; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 12px; color: #718096;">Tipo de
            Mapa:</label>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <button type="button" class="map-layer-btn active" data-layer="street" style="
              padding: 6px 12px;
              border: 2px solid #3b82f6;
              background: #3b82f6;
              color: white;
              border-radius: 6px;
              cursor: pointer;
              font-weight: 600;
              font-size: 12px;
            ">üõ£Ô∏è Calle</button>
            <button type="button" class="map-layer-btn" data-layer="satellite" style="
              padding: 6px 12px;
              border: 2px solid #e2e8f0;
              background: white;
              color: #718096;
              border-radius: 6px;
              cursor: pointer;
              font-weight: 600;
              font-size: 12px;
            ">ÔøΩÔ∏è Sat√©lite</button>
            <button type="button" class="map-layer-btn" data-layer="terrain" style="
              padding: 6px 12px;
              border: 2px solid #e2e8f0;
              background: white;
              color: #718096;
              border-radius: 6px;
              cursor: pointer;
              font-weight: 600;
              font-size: 12px;
            ">üèîÔ∏è Terreno</button>
          </div>
        </div>

        <div id="qr-map-container"
          style="width: 100%; height: 400px; margin: 10px 0; border-radius: 8px; overflow: hidden;"></div>

        <div class="qr-map-info">
          <div>
            <label>Latitud:</label>
            <input type="text" id="qr-map-lat-display" readonly />
          </div>
          <div>
            <label>Longitud:</label>
            <input type="text" id="qr-map-lng-display" readonly />
          </div>
        </div>
      </div>

      <div class="qr-map-footer">
        <button type="button" class="btn-modern success" id="qr-map-save">‚úÖ Guardar Ubicaci√≥n</button>
        <button type="button" class="btn-modern secondary" id="qr-map-cancel">‚ùå Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal para elegir tama√±o de descarga en masa -->
  <div class="modal" id="qrSizeModal" aria-hidden="true" role="dialog" aria-labelledby="qrSizeTitle" aria-modal="true">
    <div class="modal-box" style="max-width: 400px;">
      <h3 id="qrSizeTitle">Tama√±o de QR para Descarga</h3>
      <form id="qrSizeForm">
        <div style="margin: 20px 0;">
          <label style="display: block; margin-bottom: 12px;">
            <strong>Ancho (p√≠xeles):</strong>
            <input type="number" id="qrBulkWidth" value="80" min="40" max="200"
              style="width: 100%; padding: 8px; margin-top: 4px;" />
            <small style="color: #a7b0d6; display: block; margin-top: 4px;">Rango: 40 - 200px</small>
          </label>
          <label style="display: block;">
            <strong>Alto (p√≠xeles):</strong>
            <input type="number" id="qrBulkHeight" value="80" min="40" max="200"
              style="width: 100%; padding: 8px; margin-top: 4px;" />
            <small style="color: #a7b0d6; display: block; margin-top: 4px;">Rango: 40 - 200px</small>
          </label>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn secondary" id="qrSizeCancel">Cancelar</button>
          <button type="submit" class="btn">Descargar PDF</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Confirmaci√≥n para Eliminar QR -->
  <!-- Modal de Confirmaci√≥n para Eliminar Rondas -->
  <div class="modal" id="deleteRondaModal" aria-hidden="true" role="dialog" aria-labelledby="deleteRondaTitle"
    aria-modal="true">
    <div class="modal-box" style="max-width: 500px; width: 90%; margin: 0 auto;">
      <div style="text-align: center; padding: 20px 10px 0 10px;">
        <div style="font-size: 56px; margin-bottom: 20px; color: #ff6b6b; line-height: 1;">‚ö†Ô∏è</div>
        <h3 id="deleteRondaTitle"
          style="margin: 0 0 16px 0; font-size: 22px; color: #2d3748; font-weight: 700; line-height: 1.4;">¬øEliminar
          esta ronda?</h3>
        <p style="margin: 0 0 24px 0; color: #718096; font-size: 14px; line-height: 1.6;">Esta acci√≥n no se puede
          deshacer. La ronda ser√° eliminada permanentemente.</p>
        <div
          style="padding: 16px; background-color: #fef3f3; border-radius: 10px; border-left: 5px solid #ff6b6b; text-align: left; margin-bottom: 28px;">
          <strong
            style="color: #2d3748; font-size: 12px; text-transform: uppercase; display: block; margin-bottom: 10px; letter-spacing: 0.5px;">Ronda
            a eliminar:</strong>
          <p id="deleteRondaName"
            style="margin: 0; color: #2d3748; font-size: 15px; font-weight: 600; word-break: break-word; line-height: 1.5;">
          </p>
        </div>
      </div>
      <div
        style="display: flex; flex-direction: row; gap: 12px; justify-content: center; margin-top: 28px; padding: 0 10px 10px 10px;">
        <button type="button" class="btn secondary" id="deleteRondaCancel"
          style="flex: 1; max-width: 160px; padding: 12px 16px; font-size: 14px; font-weight: 600;">Cancelar</button>
        <button type="button" class="btn" id="deleteRondaConfirm"
          style="flex: 1; max-width: 160px; padding: 12px 16px; font-size: 14px; font-weight: 600; background-color: #ff6b6b; border-color: #ff6b6b; color: white; box-shadow: 0 4px 14px rgba(255, 107, 107, 0.25);">Eliminar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmaci√≥n para Eliminar QRs -->
  <div class="modal" id="deleteQRModal" aria-hidden="true" role="dialog" aria-labelledby="deleteQRTitle"
    aria-modal="true">
    <div class="modal-box" style="max-width: 500px; width: 90%; margin: 0 auto;">
      <div style="text-align: center; padding: 20px 10px 0 10px;">
        <div style="font-size: 56px; margin-bottom: 20px; color: #ff6b6b; line-height: 1;">‚ö†Ô∏è</div>
        <h3 id="deleteQRTitle"
          style="margin: 0 0 16px 0; font-size: 22px; color: #2d3748; font-weight: 700; line-height: 1.4;">¬øEliminar
          este QR?</h3>
        <p style="margin: 0 0 24px 0; color: #718096; font-size: 14px; line-height: 1.6;">Esta acci√≥n no se puede
          deshacer. El QR ser√° eliminado permanentemente.</p>
        <div
          style="padding: 16px; background-color: #fef3f3; border-radius: 10px; border-left: 5px solid #ff6b6b; text-align: left; margin-bottom: 28px;">
          <strong
            style="color: #2d3748; font-size: 12px; text-transform: uppercase; display: block; margin-bottom: 10px; letter-spacing: 0.5px;">QR
            a eliminar:</strong>
          <p id="deleteQRName"
            style="margin: 0; color: #2d3748; font-size: 15px; font-weight: 600; word-break: break-word; line-height: 1.5;">
          </p>
        </div>
      </div>
      <div
        style="display: flex; flex-direction: row; gap: 12px; justify-content: center; margin-top: 28px; padding: 0 10px 10px 10px;">
        <button type="button" class="btn secondary" id="deleteQRCancel"
          style="flex: 1; max-width: 160px; padding: 12px 16px; font-size: 14px; font-weight: 600;">Cancelar</button>
        <button type="button" class="btn" id="deleteQRConfirm"
          style="flex: 1; max-width: 160px; padding: 12px 16px; font-size: 14px; font-weight: 600; background-color: #ff6b6b; border-color: #ff6b6b; color: white; box-shadow: 0 4px 14px rgba(255, 107, 107, 0.25);">Eliminar</button>
      </div>
    </div>
  </div>

  <!-- SheetJS (XLSX) para exportaci√≥n a Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- Control de Acceso (Roles) -->
  <script src="access-control.js"></script>

  <!-- L√≥gica principal -->
  <script src="menu.js"></script>
  <!-- MODAL: Restablecer Contrase√±a (Admin) -->
  <div class="modal" id="modal-password-reset" aria-hidden="true">
    <div class="modal-box">
      <h3 class="title" style="margin-bottom:16px;">Restablecer Contrase√±a</h3>
      <p class="muted" style="margin-bottom:20px;">
        Esta acci√≥n cambiar√° inmediatamente la contrase√±a del usuario.
      </p>
      <form id="form-password-reset" class="grid-2" style="grid-template-columns: 1fr;">
        <label>
          Nueva Contrase√±a
          <input type="password" id="reset-new-password" placeholder="M√≠nimo 6 caracteres" required minlength="6" />
        </label>
        <label>
          Confirmar Contrase√±a
          <input type="password" id="reset-confirm-password" placeholder="Repita la contrase√±a" required />
        </label>
      </form>
      <div class="modal-actions">
        <button type="button" class="btn secondary" id="btn-cancel-reset">Cancelar</button>
        <button type="button" class="btn" id="btn-save-reset">Guardar Cambios</button>
      </div>
    </div>
  </div>

</body>

</html>